<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oráculo de Tarot - 3 Cartas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Quattrocento&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quattrocento', serif;
            background-color: #1a1a2e;
            background-image: radial-gradient(circle at top right, #4a148c 0%, #1a1a2e 50%);
            color: #e0e0e0;
        }
        h1, h2 {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .card-container {
            perspective: 1000px;
        }
        .card {
            width: 100%;
            aspect-ratio: 2/3.5;
            max-width: 200px;
            transition: transform 0.8s, box-shadow 0.3s;
            transform-style: preserve-3d;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border-radius: 12px;
        }
        .card-placeholder {
            border: 2px dashed #4a148c;
            background-color: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card img {
            border-radius: 12px;
            border: 2px solid #f0e68c;
        }
        .draw-button {
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .draw-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(147, 51, 234, 0.5);
        }
        .draw-button:active {
            transform: translateY(1px);
        }
        #interpretation-result {
            background-color: rgba(0,0,0,0.3);
            border-left: 4px solid #9333ea;
        }
        .loader {
            border: 4px solid #f3f3f340;
            border-top: 4px solid #9333ea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-4xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl text-purple-300 mb-2">Oráculo de Tarot</h1>
        <p class="text-purple-200 mb-8">Tire 3 cartas para uma visão sobre seu Passado, Presente e Futuro.</p>

        <!-- Área para exibir as cartas sorteadas -->
        <div id="cards-display" class="grid grid-cols-3 gap-4 md:gap-8 mb-8 min-h-[250px] md:min-h-[350px] items-center">
            <div class="text-center">
                <h2 class="text-xl mb-2 text-purple-300">Passado</h2>
                <div id="card1" class="card-container mx-auto"><div class="card card-placeholder"><span class="text-purple-400">I</span></div></div>
            </div>
            <div class="text-center">
                <h2 class="text-xl mb-2 text-purple-300">Presente</h2>
                <div id="card2" class="card-container mx-auto"><div class="card card-placeholder"><span class="text-purple-400">II</span></div></div>
            </div>
            <div class="text-center">
                <h2 class="text-xl mb-2 text-purple-300">Futuro</h2>
                <div id="card3" class="card-container mx-auto"><div class="card card-placeholder"><span class="text-purple-400">III</span></div></div>
            </div>
        </div>

        <!-- Botão para sortear -->
        <button id="draw-button" class="draw-button bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg">
            Consultar o Oráculo
        </button>

        <!-- Área para a interpretação -->
        <div id="interpretation" class="mt-8 text-left w-full max-w-3xl mx-auto hidden">
            <h2 class="text-2xl text-purple-300 mb-4">A Mensagem das Cartas</h2>
            <div id="interpretation-result" class="p-6 rounded-lg text-lg leading-relaxed">
                <!-- O resultado da interpretação aparecerá aqui -->
            </div>
        </div>
        
        <!-- Indicador de Carregamento -->
        <div id="loader" class="mt-8 hidden">
            <div class="loader mx-auto"></div>
            <p class="mt-2 text-purple-300">O oráculo está interpretando sua tiragem...</p>
        </div>

    </div>

    <script>
        const drawButton = document.getElementById('draw-button');
        const cardsDisplay = document.getElementById('cards-display');
        const interpretationDiv = document.getElementById('interpretation');
        const interpretationResult = document.getElementById('interpretation-result');
        const loader = document.getElementById('loader');

        // --- Banco de Dados dos 22 Arcanos Maiores ---
        const majorArcana = [
            { id: 0, name: "O Louco", image: "https://www.sacred-texts.com/tarot/pkt/img/ar00.jpg", meaning: "Início de uma jornada, espontaneidade, fé, inocência e potencial ilimitado. Um convite para dar um salto de fé no desconhecido." },
            { id: 1, name: "O Mago", image: "https://www.sacred-texts.com/tarot/pkt/img/ar01.jpg", meaning: "Poder, habilidade, concentração e manifestação. Possui todas as ferramentas para criar sua própria realidade. É hora de agir." },
            { id: 2, name: "A Sacerdotisa", image: "https://www.sacred-texts.com/tarot/pkt/img/ar02.jpg", meaning: "Intuição, mistério, subconsciente e sabedoria oculta. Um chamado para olhar para dentro e confiar na sua voz interior." },
            { id: 3, name: "A Imperatriz", image: "https://www.sacred-texts.com/tarot/pkt/img/ar03.jpg", meaning: "Fertilidade, abundância, criatividade e conexão com a natureza. Um momento de nutrir a si mesmo e aos seus projetos." },
            { id: 4, name: "O Imperador", image: "https://www.sacred-texts.com/tarot/pkt/img/ar04.jpg", meaning: "Autoridade, estrutura, estabilidade e liderança. Um chamado para a disciplina e o controle para construir bases sólidas." },
            { id: 5, name: "O Hierofante", image: "https://www.sacred-texts.com/tarot/pkt/img/ar05.jpg", meaning: "Tradição, instituições, educação e crenças. Busca por conhecimento através de métodos convencionais ou de um mentor." },
            { id: 6, name: "Os Enamorados", image: "https://www.sacred-texts.com/tarot/pkt/img/ar06.jpg", meaning: "Escolhas, união, relacionamentos e harmonia. Aponta para uma decisão importante, alinhada com seus valores mais profundos." },
            { id: 7, name: "O Carro", image: "https://www.sacred-texts.com/tarot/pkt/img/ar07.jpg", meaning: "Vitória, determinação, autocontrole e avanço. Com foco e disciplina, o sucesso em seus objetivos é certo." },
            { id: 8, name: "A Força", image: "https://www.sacred-texts.com/tarot/pkt/img/ar08.jpg", meaning: "Coragem, paciência, compaixão e domínio interior. A verdadeira força não vem da agressividade, mas do autocontrole gentil." },
            { id: 9, name: "O Eremita", image: "https://www.sacred-texts.com/tarot/pkt/img/ar09.jpg", meaning: "Introspecção, sabedoria e busca interior. Um momento de se afastar do mundo para encontrar a luz da sua própria verdade." },
            { id: 10, name: "A Roda da Fortuna", image: "https://www.sacred-texts.com/tarot/pkt/img/ar10.jpg", meaning: "Mudanças, ciclos, destino e pontos de virada. A vida está em constante movimento, trazendo novas oportunidades e desafios." },
            { id: 11, name: "A Justiça", image: "https://www.sacred-texts.com/tarot/pkt/img/ar11.jpg", meaning: "Equilíbrio, verdade, clareza e causa e efeito. É hora de tomar decisões justas, pois a verdade virá à tona." },
            { id: 12, name: "O Enforcado", image: "https://www.sacred-texts.com/tarot/pkt/img/ar12.jpg", meaning: "Sacrifício, nova perspectiva e rendição. É preciso fazer uma pausa e ver as coisas por um ângulo diferente para progredir." },
            { id: 13, name: "A Morte", image: "https://www.sacred-texts.com/tarot/pkt/img/ar13.jpg", meaning: "Fim de um ciclo, transformação e renovação. Um final necessário para que algo novo e melhor possa começar." },
            { id: 14, name: "A Temperança", image: "https://www.sacred-texts.com/tarot/pkt/img/ar14.jpg", meaning: "Equilíbrio, moderação, paciência e harmonia. Um convite para encontrar o meio-termo e integrar opostos em sua vida." },
            { id: 15, name: "O Diabo", image: "https://www.sacred-texts.com/tarot/pkt/img/ar15.jpg", meaning: "Apego, materialismo, vícios e ilusão. Revela padrões negativos e apegos que precisam ser confrontados para alcançar a liberdade." },
            { id: 16, name: "A Torre", image: "https://www.sacred-texts.com/tarot/pkt/img/ar16.jpg", meaning: "Mudança súbita, revelação e quebra de estruturas. Uma destruição necessária de falsas crenças para construir algo mais verdadeiro." },
            { id: 17, name: "A Estrela", image: "https://www.sacred-texts.com/tarot/pkt/img/ar17.jpg", meaning: "Esperança, inspiração, cura e renovação. Após a tempestade, um momento de paz, fé e otimismo no futuro." },
            { id: 18, name: "A Lua", image: "https://www.sacred-texts.com/tarot/pkt/img/ar18.jpg", meaning: "Ilusão, medo, intuição e inconsciente. Nem tudo é o que parece. É preciso confiar na intuição para navegar pela incerteza." },
            { id: 19, name: "O Sol", image: "https://www.sacred-texts.com/tarot/pkt/img/ar19.jpg", meaning: "Alegria, sucesso, vitalidade e clareza. Um período de grande felicidade, otimismo e realização." },
            { id: 20, name: "O Julgamento", image: "https://www.sacred-texts.com/tarot/pkt/img/ar20.jpg", meaning: "Renascimento, despertar e chamado. Um momento de avaliação e perdão, levando a um novo nível de consciência." },
            { id: 21, name: "O Mundo", image: "https://www.sacred-texts.com/tarot/pkt/img/ar21.jpg", meaning: "Conclusão, realização, integração e plenitude. O fim bem-sucedido de uma jornada, alcançando um estado de totalidade." }
        ];

        drawButton.addEventListener('click', handleDraw);

        function handleDraw() {
            interpretationDiv.classList.add('hidden');
            loader.classList.remove('hidden');
            drawButton.disabled = true;
            drawButton.classList.add('opacity-50', 'cursor-not-allowed');

            const shuffled = [...majorArcana].sort(() => 0.5 - Math.random());
            const drawnCards = shuffled.slice(0, 3);
            
            displayDrawnCards(drawnCards);
            generateInterpretation(drawnCards);
        }

        function displayDrawnCards(cards) {
            for (let i = 0; i < cards.length; i++) {
                const cardDiv = document.getElementById(`card${i + 1}`);
                const card = cards[i];
                cardDiv.innerHTML = `
                    <div class="card">
                        <img src="${card.image}" alt="${card.name}" class="w-full h-full object-cover">
                    </div>
                `;
            }
        }

        async function generateInterpretation(cards) {
            try {
                // A URL agora aponta para a nossa função "ajudante" no Netlify
                const response = await fetch('/.netlify/functions/getInterpretation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cards: cards }) // Enviamos as cartas sorteadas
                });

                if (!response.ok) {
                    throw new Error(`Erro na função do servidor: ${response.statusText}`);
                }

                const result = await response.json();
                
                const formattedText = result.interpretation
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');

                interpretationResult.innerHTML = formattedText;

            } catch (error) {
                console.error("Erro ao gerar interpretação:", error);
                interpretationResult.innerHTML = "Houve um erro ao contatar o oráculo. Por favor, verifique sua conexão e tente novamente.";
            } finally {
                loader.classList.add('hidden');
                interpretationDiv.classList.remove('hidden');
                drawButton.disabled = false;
                drawButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
    </script>
</body>
</html>

